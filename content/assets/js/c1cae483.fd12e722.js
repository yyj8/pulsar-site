"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[51572],{3905:(e,a,n)=>{n.d(a,{Zo:()=>i,kt:()=>h});var t=n(67294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function s(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function c(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var m=t.createContext({}),l=function(e){var a=t.useContext(m),n=a;return e&&(n="function"==typeof e?e(a):s(s({},a),e)),n},i=function(e){var a=l(e.components);return t.createElement(m.Provider,{value:a},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},d=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,o=e.originalType,m=e.parentName,i=c(e,["components","mdxType","originalType","parentName"]),p=l(n),d=r,h=p["".concat(m,".").concat(d)]||p[d]||u[d]||o;return n?t.createElement(h,s(s({ref:a},i),{},{components:n})):t.createElement(h,s({ref:a},i))}));function h(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var c={};for(var m in a)hasOwnProperty.call(a,m)&&(c[m]=a[m]);c.originalType=e,c[p]="string"==typeof e?e:r,s[1]=c;for(var l=2;l<o;l++)s[l]=n[l];return t.createElement.apply(null,s)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,a,n)=>{n.d(a,{Z:()=>s});var t=n(67294),r=n(86010);const o={tabItem:"tabItem_Ymn6"};function s(e){let{children:a,hidden:n,className:s}=e;return t.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,s),hidden:n},a)}},65488:(e,a,n)=>{n.d(a,{Z:()=>u});var t=n(87462),r=n(67294),o=n(86010),s=n(72389),c=n(67392),m=n(7094),l=n(12466);const i={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function p(e){const{lazy:a,block:n,defaultValue:s,values:p,groupId:u,className:d}=e,h=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),g=p??h.map((e=>{let{props:{value:a,label:n,attributes:t}}=e;return{value:a,label:n,attributes:t}})),k=(0,c.l)(g,((e,a)=>e.value===a.value));if(k.length>0)throw new Error(`Docusaurus error: Duplicate values "${k.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const N=null===s?s:s??h.find((e=>e.props.default))?.props.value??h[0].props.value;if(null!==N&&!g.some((e=>e.value===N)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${N}" but none of its children has the corresponding value. Available values are: ${g.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:y}=(0,m.U)(),[b,f]=(0,r.useState)(N),S=[],{blockElementScrollPositionUntilNextRender:C}=(0,l.o5)();if(null!=u){const e=v[u];null!=e&&e!==b&&g.some((a=>a.value===e))&&f(e)}const T=e=>{const a=e.currentTarget,n=S.indexOf(a),t=g[n].value;t!==b&&(C(a),f(t),null!=u&&y(u,String(t)))},P=e=>{let a=null;switch(e.key){case"Enter":T(e);break;case"ArrowRight":{const n=S.indexOf(e.currentTarget)+1;a=S[n]??S[0];break}case"ArrowLeft":{const n=S.indexOf(e.currentTarget)-1;a=S[n]??S[S.length-1];break}}a?.focus()};return r.createElement("div",{className:(0,o.Z)("tabs-container",i.tabList)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},d)},g.map((e=>{let{value:a,label:n,attributes:s}=e;return r.createElement("li",(0,t.Z)({role:"tab",tabIndex:b===a?0:-1,"aria-selected":b===a,key:a,ref:e=>S.push(e),onKeyDown:P,onClick:T},s,{className:(0,o.Z)("tabs__item",i.tabItem,s?.className,{"tabs__item--active":b===a})}),n??a)}))),a?(0,r.cloneElement)(h.filter((e=>e.props.value===b))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},h.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==b})))))}function u(e){const a=(0,s.Z)();return r.createElement(p,(0,t.Z)({key:String(a)},e))}},46484:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>m,default:()=>h,frontMatter:()=>c,metadata:()=>l,toc:()=>p});var t=n(87462),r=(n(67294),n(3905)),o=n(65488),s=n(85162);const c={id:"schema-get-started",title:"Get started",sidebar_label:"Get started"},m=void 0,l={unversionedId:"schema-get-started",id:"schema-get-started",title:"Get started",description:"This hands-on tutorial provides instructions and examples on how to construct schemas. For instructions on administrative tasks, see Manage schema.",source:"@site/docs/schema-get-started.md",sourceDirName:".",slug:"/schema-get-started",permalink:"/docs/next/schema-get-started",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/docs/schema-get-started.md",tags:[],version:"current",frontMatter:{id:"schema-get-started",title:"Get started",sidebar_label:"Get started"},sidebar:"docsSidebar",previous:{title:"Understand schema",permalink:"/docs/next/schema-understand"},next:{title:"Overview",permalink:"/docs/next/functions-overview"}},i={},p=[{value:"Construct a schema",id:"construct-a-schema",level:2},{value:"bytes",id:"bytes",level:3},{value:"string",id:"string",level:3},{value:"key/value",id:"keyvalue",level:3},{value:"Avro",id:"avro",level:3},{value:"JSON",id:"json",level:3},{value:"ProtobufNative",id:"protobufnative",level:3},{value:"Protobuf",id:"protobuf",level:3},{value:"Native Avro",id:"native-avro",level:3},{value:"AUTO_PRODUCE",id:"auto_produce",level:3},{value:"AUTO_CONSUME",id:"auto_consume",level:3},{value:"Customize schema storage",id:"customize-schema-storage",level:2},{value:"Implement <code>SchemaStorage</code> interface",id:"implement-schemastorage-interface",level:3},{value:"Implement <code>SchemaStorageFactory</code> interface",id:"implement-schemastoragefactory-interface",level:3},{value:"Deploy custom schema storage",id:"deploy-custom-schema-storage",level:3}],u={toc:p},d="wrapper";function h(e){let{components:a,...n}=e;return(0,r.kt)(d,(0,t.Z)({},u,n,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This hands-on tutorial provides instructions and examples on how to construct schemas. For instructions on administrative tasks, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/admin-api-schemas"},"Manage schema"),"."),(0,r.kt)("h2",{id:"construct-a-schema"},"Construct a schema"),(0,r.kt)("h3",{id:"bytes"},"bytes"),(0,r.kt)("p",null,"This example demonstrates how to construct a ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#primitive-type"},"bytes schema")," using language-specific clients and use it to produce and consume messages."),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Python",value:"Python"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<byte[]> producer = PulsarClient.newProducer(Schema.BYTES)\n       .topic("my-topic")\n       .create();\nConsumer<byte[]> consumer = pulsarClient.newConsumer(Schema.BYTES)\n       .topic("my-topic")\n       .subscriptionName("my-sub")\n       .subscribe();\n\nproducer.newMessage().value("message".getBytes()).send();\n\nMessage<byte[]> message = consumer.receive(5, TimeUnit.SECONDS);\n'))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'SchemaInfo schemaInfo = SchemaInfo(SchemaType::BYTES, "Bytes", "");\nProducer producer;\nclient.createProducer("topic-bytes", ProducerConfiguration().setSchema(schemaInfo), producer);\nstd::array<char, 1024> buffer;\nproducer.send(MessageBuilder().setContent(buffer.data(), buffer.size()).build());\nConsumer consumer;\nres = client.subscribe("topic-bytes", "my-sub", ConsumerConfiguration().setSchema(schemaInfo), consumer);\nMessage msg;\nconsumer.receive(msg, 3000);\n'))),(0,r.kt)(s.Z,{value:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"producer = client.create_producer(\n   'bytes-schema-topic',\n   schema=BytesSchema())\nproducer.send(b\"Hello\")\n\nconsumer = client.subscribe(\n   'bytes-schema-topic',\n    'sub',\n    schema=BytesSchema())\nmsg = consumer.receive()\ndata = msg.value()\n"))),(0,r.kt)(s.Z,{value:"Go",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'producer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic:  "my-topic",\n    Schema: pulsar.NewBytesSchema(nil),\n})\nid, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Value: []byte("message"),\n})\n\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "my-topic",\n    Schema:           pulsar.NewBytesSchema(nil),\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Exclusive,\n})\n')))),(0,r.kt)("h3",{id:"string"},"string"),(0,r.kt)("p",null,"This example demonstrates how to construct a ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#primitive-type"},"string schema")," using language-specific clients and use it to produce and consume messages."),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Python",value:"Python"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<String> producer = client.newProducer(Schema.STRING).create();\nproducer.newMessage().value("Hello Pulsar!").send();\n\nConsumer<String> consumer = client.newConsumer(Schema.STRING).subscribe();\nMessage<String> message = consumer.receive();\n'))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'SchemaInfo schemaInfo = SchemaInfo(SchemaType::STRING, "String", "");\nProducer producer;\nclient.createProducer("topic-string", ProducerConfiguration().setSchema(schemaInfo), producer);\nproducer.send(MessageBuilder().setContent("message").build());\n\nConsumer consumer;\nclient.subscribe("topic-string", "my-sub", ConsumerConfiguration().setSchema(schemaInfo), consumer);\nMessage msg;\nconsumer.receive(msg, 3000);\n'))),(0,r.kt)(s.Z,{value:"Python",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"producer = client.create_producer(\n      'string-schema-topic',\n      schema=StringSchema())\nproducer.send(\"Hello\")\n\nconsumer = client.subscribe(\n        'string-schema-topic',\n        'sub',\n        schema=StringSchema())\nmsg = consumer.receive()\nstr = msg.value()\n"))),(0,r.kt)(s.Z,{value:"Go",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'producer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic:  "my-topic",\n    Schema: pulsar.NewStringSchema(nil),\n})\nid, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Value: "message",\n})\n\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "my-topic",\n    Schema:           pulsar.NewStringSchema(nil),\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Exclusive,\n})\nmsg, err := consumer.Receive(context.Background())\n')))),(0,r.kt)("h3",{id:"keyvalue"},"key/value"),(0,r.kt)("p",null,"This example shows how to construct a ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#keyvalue-schema"},"key/value schema")," using language-specific clients and use it to produce and consume messages."),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Construct a key/value schema with ",(0,r.kt)("inlineCode",{parentName:"p"},"INLINE")," encoding type."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Schema<KeyValue<Integer, String>> kvSchema = Schema.KeyValue(\n    Schema.INT32,\n    Schema.STRING,\n    KeyValueEncodingType.INLINE\n);\n")),(0,r.kt)("p",{parentName:"li"},"Alternatively, construct a key/value schema with ",(0,r.kt)("inlineCode",{parentName:"p"},"SEPARATED")," encoding type."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Schema<KeyValue<Integer, String>> kvSchema = Schema.KeyValue(\n    Schema.INT32,\n    Schema.STRING,\n    KeyValueEncodingType.SEPARATED\n);\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Produce messages using a key/value schema."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<KeyValue<Integer, String>> producer = client.newProducer(kvSchema)\n    .topic(topicName)\n    .create();\n\nfinal int key = 100;\nfinal String value = "value-100";\n\n// send the key/value message\nproducer.newMessage()\n    .value(new KeyValue(key, value))\n    .send();\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Consume messages using a key/value schema."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Consumer<KeyValue<Integer, String>> consumer = client.newConsumer(kvSchema)\n    ...\n    .topic(topicName)\n    .subscriptionName(subscriptionName).subscribe();\n\n// receive key/value pair\nMessage<KeyValue<Integer, String>> msg = consumer.receive();\nKeyValue<Integer, String> kv = msg.getValue();\n"))))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Construct a key/value schema with ",(0,r.kt)("inlineCode",{parentName:"p"},"INLINE")," encoding type."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'//Prepare keyValue schema\nstd::string jsonSchema =\nR"({"type":"record","name":"cpx","fields":[{"name":"re","type":"double"},{"name":"im","type":"double"}]})";\nSchemaInfo keySchema(JSON, "key-json", jsonSchema);\nSchemaInfo valueSchema(JSON, "value-json", jsonSchema);\nSchemaInfo keyValueSchema(keySchema, valueSchema, KeyValueEncodingType::INLINE);\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Produce messages using a key/value schema."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'//Create Producer\nProducer producer;\nclient.createProducer("my-topic", ProducerConfiguration().setSchema(keyValueSchema), producer);\n\n//Prepare message\nstd::string jsonData = "{\\"re\\":2.1,\\"im\\":1.23}";\nKeyValue keyValue(std::move(jsonData), std::move(jsonData));\nMessage msg = MessageBuilder().setContent(keyValue).setProperty("x", "1").build();\n//Send message\nproducer.send(msg);\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Consume messages using a key/value schema."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'//Create Consumer\nConsumer consumer;\nclient.subscribe("my-topic", "my-sub", ConsumerConfiguration().setSchema(keyValueSchema), consumer);\n\n//Receive message\nMessage message;\nconsumer.receive(message);\n')))))),(0,r.kt)("h3",{id:"avro"},"Avro"),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Python",value:"Python"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("p",null,"Suppose you have a ",(0,r.kt)("inlineCode",{parentName:"p"},"SensorReading")," class as follows, and you'd like to transmit it over a Pulsar topic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class SensorReading {\n    public float temperature;\n\n    public SensorReading(float temperature) {\n        this.temperature = temperature;\n    }\n\n    // A no-arg constructor is required\n    public SensorReading() {\n    }\n\n    public float getTemperature() {\n        return temperature;\n    }\n\n    public void setTemperature(float temperature) {\n        this.temperature = temperature;\n    }\n}\n")),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"Producer<SensorReading>")," (or ",(0,r.kt)("inlineCode",{parentName:"p"},"Consumer<SensorReading>"),") like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<SensorReading> producer = client.newProducer(AvroSchema.of(SensorReading.class))\n        .topic("sensor-readings")\n        .create();\n'))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'// Send messages\nstatic const std::string exampleSchema =\n    "{\\"type\\":\\"record\\",\\"name\\":\\"Example\\",\\"namespace\\":\\"test\\","\n    "\\"fields\\":[{\\"name\\":\\"a\\",\\"type\\":\\"int\\"},{\\"name\\":\\"b\\",\\"type\\":\\"int\\"}]}";\nProducer producer;\nProducerConfiguration producerConf;\nproducerConf.setSchema(SchemaInfo(AVRO, "Avro", exampleSchema));\nclient.createProducer("topic-avro", producerConf, producer);\n\n// Receive messages\nstatic const std::string exampleSchema =\n    "{\\"type\\":\\"record\\",\\"name\\":\\"Example\\",\\"namespace\\":\\"test\\","\n    "\\"fields\\":[{\\"name\\":\\"a\\",\\"type\\":\\"int\\"},{\\"name\\":\\"b\\",\\"type\\":\\"int\\"}]}";\nConsumerConfiguration consumerConf;\nConsumer consumer;\nconsumerConf.setSchema(SchemaInfo(AVRO, "Avro", exampleSchema));\nclient.subscribe("topic-avro", "sub-2", consumerConf, consumer)\n'))),(0,r.kt)(s.Z,{value:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"You can declare an ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," using Python through one of the following methods."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Method 1: Record")),(0,r.kt)("p",null,"Declare an ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," by passing a class that inherits from ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar.schema.Record")," and defines the fields as class variables."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"class Example(Record):\n    a = Integer()\n    b = Integer()\n\nproducer = client.create_producer(\n   'avro-schema-topic',\n   schema=AvroSchema(Example))\nr = Example(a=1, b=2)\nproducer.send(r)\n\nconsumer = client.subscribe(\n   'avro-schema-topic',\n    'sub',\n    schema=AvroSchema(Example))\nmsg = consumer.receive()\ne = msg.value()\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Method 2: JSON definition")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Declare an ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," using JSON. In this case, Avro schemas are defined using JSON."),(0,r.kt)("p",{parentName:"li"},"Below is an example of ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," defined using a JSON file (",(0,r.kt)("inlineCode",{parentName:"p"},"company.avsc"),")."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "doc": "this is doc",\n    "namespace": "example.avro",\n    "type": "record",\n    "name": "Company",\n    "fields": [\n        {"name": "name", "type": ["null", "string"]},\n        {"name": "address", "type": ["null", "string"]},\n        {"name": "employees", "type": ["null", {"type": "array", "items": {\n            "type": "record",\n            "name": "Employee",\n            "fields": [\n                {"name": "name", "type": ["null", "string"]},\n                {"name": "age", "type": ["null", "int"]}\n            ]\n        }}]},\n        {"name": "labels", "type": ["null", {"type": "map", "values": "string"}]}\n    ]\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Load a schema definition from a file by using ",(0,r.kt)("a",{parentName:"p",href:"https://avro.apache.org/docs/current/getting-started-python/"},(0,r.kt)("inlineCode",{parentName:"a"},"avro.schema"))," or ",(0,r.kt)("a",{parentName:"p",href:"https://fastavro.readthedocs.io/en/latest/schema.html#fastavro._schema_py.load_schema"},(0,r.kt)("inlineCode",{parentName:"a"},"fastavro.schema")),"."),(0,r.kt)("p",{parentName:"li"},"If you use the ",(0,r.kt)("a",{parentName:"p",href:"#method-2-json-definition"},"JSON definition")," method to declare an ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema"),", you need to:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Use ",(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/edu/python/dict-files"},"Python dict")," to produce and consume messages, which is different from using the ",(0,r.kt)("a",{parentName:"li",href:"#method-1-record"},"Record")," method."),(0,r.kt)("li",{parentName:"ul"},"Set the value of the ",(0,r.kt)("inlineCode",{parentName:"li"},"_record_cls")," parameter to ",(0,r.kt)("inlineCode",{parentName:"li"},"None")," when generating an ",(0,r.kt)("inlineCode",{parentName:"li"},"AvroSchema")," object.")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Example")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-python"},'from fastavro.schema import load_schema\nfrom pulsar.schema import *\nschema_definition = load_schema("examples/company.avsc")\navro_schema = AvroSchema(None, schema_definition=schema_definition)\nproducer = client.create_producer(\n    topic=topic,\n    schema=avro_schema)\nconsumer = client.subscribe(topic, \'test\', schema=avro_schema)\ncompany = {\n    "name": "company-name" + str(i),\n    "address": \'xxx road xxx street \' + str(i),\n    "employees": [\n        {"name": "user" + str(i), "age": 20 + i},\n        {"name": "user" + str(i), "age": 30 + i},\n        {"name": "user" + str(i), "age": 35 + i},\n    ],\n    "labels": {\n        "industry": "software" + str(i),\n        "scale": ">100",\n        "funds": "1000000.0"\n    }\n}\nproducer.send(company)\nmsg = consumer.receive()\n# Users could get a dict object by `value()` method.\nmsg.value()\n'))))),(0,r.kt)(s.Z,{value:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Suppose you have an ",(0,r.kt)("inlineCode",{parentName:"p"},"avroExampleStruct")," class as follows, and you'd like to transmit it over a Pulsar topic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"    type avroExampleStruct struct {\n    ID   int\n    Name string\n}\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add an ",(0,r.kt)("inlineCode",{parentName:"p"},"avroSchemaDef")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'var (\n    exampleSchemaDef = "{\\"type\\":\\"record\\",\\"name\\":\\"Example\\",\\"namespace\\":\\"test\\"," +\n  "\\"fields\\":[{\\"name\\":\\"ID\\",\\"type\\":\\"int\\"},{\\"name\\":\\"Name\\",\\"type\\":\\"string\\"}]}"\n)\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create producer and consumer to send/receive messages:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'//Create producer and send message\nproducer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic:  "my-topic",\n    Schema: pulsar.NewAvroSchema(exampleSchemaDef, nil),\n})\n\nmsgId, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Value: avroExampleStruct{\n       ID:   10,\n       Name: "avroExampleStruct",\n  },\n})\n\n//Create Consumer and receive message\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "my-topic",\n    Schema:           pulsar.NewAvroSchema(exampleSchemaDef, nil),\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Shared,\n})\nmessage, err := consumer.Receive(context.Background())\n')))))),(0,r.kt)("h3",{id:"json"},"JSON"),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Python",value:"Python"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("p",null,"Similar to using ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema"),", you can declare a ",(0,r.kt)("inlineCode",{parentName:"p"},"JsonSchema")," by passing a class. The only difference is to use  ",(0,r.kt)("inlineCode",{parentName:"p"},"JsonSchema")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," when defining the schema type, as shown below. For how to use ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," via record, see ",(0,r.kt)("a",{parentName:"p",href:"#method-1-record"},"Method 1 - Record"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'static class SchemaDemo {\n   public String name;\n   public int age;\n}\n\nProducer<SchemaDemo> producer = pulsarClient.newProducer(Schema.JSON(SchemaDemo.class))\n       .topic("my-topic")\n       .create();\nConsumer<SchemaDemo> consumer = pulsarClient.newConsumer(Schema.JSON(SchemaDemo.class))\n       .topic("my-topic")\n       .subscriptionName("my-sub")\n       .subscribe();\n\nSchemaDemo schemaDemo = new SchemaDemo();\nschemaDemo.name = "puslar";\nschemaDemo.age = 20;\nproducer.newMessage().value(schemaDemo).send();\n\nMessage<SchemaDemo> message = consumer.receive(5, TimeUnit.SECONDS);\n'))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("p",null,"To declare a ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON")," schema using C++, do the following:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Pass a JSON string like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'Std::string jsonSchema = R"({"type":"record","name":"cpx","fields":[{"name":"re","type":"double"},{"name":"im","type":"double"}]})";\nSchemaInfo schemaInfo = SchemaInfo(JSON, "JSON", jsonSchema);\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer and use it to send messages."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'client.createProducer("my-topic", ProducerConfiguration().setSchema(schemaInfo), producer);\nstd::string jsonData = "{\\"re\\":2.1,\\"im\\":1.23}";\nproducer.send(MessageBuilder().setContent(std::move(jsonData)).build());\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create consumer and receive message."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'Consumer consumer;\nclient.subscribe("my-topic", "my-sub", ConsumerConfiguration().setSchema(schemaInfo), consumer);\nMessage msg;\nconsumer.receive(msg);\n'))))),(0,r.kt)(s.Z,{value:"Python",mdxType:"TabItem"},(0,r.kt)("p",null,"You can declare a ",(0,r.kt)("inlineCode",{parentName:"p"},"JsonSchema")," by passing a class that inherits from ",(0,r.kt)("inlineCode",{parentName:"p"},"pulsar.schema.Record")," and defines the fields as class variables. This is similar to using ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema"),". The only difference is to use  ",(0,r.kt)("inlineCode",{parentName:"p"},"JsonSchema")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," when defining schema type, as shown below. For how to use ",(0,r.kt)("inlineCode",{parentName:"p"},"AvroSchema")," via record, see [#method-1-record)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"producer = client.create_producer(\n   'avro-schema-topic',\n   schema=JsonSchema(Example))\n\nconsumer = client.subscribe(\n    'avro-schema-topic',\n    'sub',\n    schema=JsonSchema(Example))\n"))),(0,r.kt)(s.Z,{value:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Suppose you have an ",(0,r.kt)("inlineCode",{parentName:"p"},"avroExampleStruct")," class as follows, and you'd like to transmit it as JSON form over a Pulsar topic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'type jsonExampleStruct struct {\n    ID   int    `json:"id"`\n    Name string `json:"name"`\n}\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("inlineCode",{parentName:"p"},"jsonSchemaDef")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'jsonSchemaDef = "{\\"type\\":\\"record\\",\\"name\\":\\"Example\\",\\"namespace\\":\\"test\\"," +\n"\\"fields\\":[{\\"name\\":\\"ID\\",\\"type\\":\\"int\\"},{\\"name\\":\\"Name\\",\\"type\\":\\"string\\"}]}"\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer/consumer to send/receive messages:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'//Create producer and send message\nproducer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic:  "my-topic",\n    Schema: pulsar.NewJSONSchema(jsonSchemaDef, nil),\n})\n\nmsgId, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Value: jsonExampleStruct{\n        ID:   10,\n        Name: "jsonExampleStruct",\n  },\n})\n\n//Create Consumer and receive message\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:            "my-topic",\n    Schema:           pulsar.NewJSONSchema(jsonSchemaDef, nil),\n    SubscriptionName: "my-sub",\n    Type:             pulsar.Exclusive,\n})\nmessage, err := consumer.Receive(context.Background())\n')))))),(0,r.kt)("h3",{id:"protobufnative"},"ProtobufNative"),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("p",null,"The following example shows how to create a producer/consumer with a ProtobufNative schema using Java."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate the ",(0,r.kt)("inlineCode",{parentName:"p"},"DemoMessage")," class using Protobuf3 or later versions."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\nmessage DemoMessage {\n   string stringField = 1;\n   double doubleField = 2;\n   int32 intField = 6;\n   TestEnum testEnum = 4;\n   SubMessage nestedField = 5;\n   repeated string repeatedField = 10;\n   proto.external.ExternalMessage externalMessage = 11;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer/consumer to send/receive messages."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<DemoMessage> producer = pulsarClient.newProducer(Schema.PROTOBUF_NATIVE(DemoMessage.class))\n    .topic("my-topic")\n    .create();\nConsumer<DemoMessage> consumer = pulsarClient.newConsumer(Schema.PROTOBUF_NATIVE(DemoMessage.class))\n    .topic("my-topic")\n    .subscriptionName("my-sub")\n    .subscribe();\n\nSchemaDemo schemaDemo = new SchemaDemo();\nschemaDemo.name = "puslar";\nschemaDemo.age = 20;\nproducer.newMessage().value(DemoMessage.newBuilder().setStringField("string-field-value")\n    .setIntField(1).build()).send();\n\nMessage<DemoMessage> message = consumer.receive(5, TimeUnit.SECONDS);\n'))))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("p",null,"The following example shows how to create a producer/consumer with a ProtobufNative schema."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate the ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," class using Protobuf3 or later versions."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\nmessage User {\n    string name = 1;\n    int32 age = 2;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Include the ",(0,r.kt)("inlineCode",{parentName:"p"},"ProtobufNativeSchema.h")," in your source code. Ensure the Protobuf dependency has been added to your project."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},"#include <pulsar/ProtobufNativeSchema.h>\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer to send a ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," instance."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'ProducerConfiguration producerConf;\nproducerConf.setSchema(createProtobufNativeSchema(User::GetDescriptor()));\nProducer producer;\nclient.createProducer("topic-protobuf", producerConf, producer);\nUser user;\nuser.set_name("my-name");\nuser.set_age(10);\nstd::string content;\nuser.SerializeToString(&content);\nproducer.send(MessageBuilder().setContent(content).build());\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a consumer to receive a ",(0,r.kt)("inlineCode",{parentName:"p"},"User")," instance."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'ConsumerConfiguration consumerConf;\nconsumerConf.setSchema(createProtobufNativeSchema(User::GetDescriptor()));\nconsumerConf.setSubscriptionInitialPosition(InitialPositionEarliest);\nConsumer consumer;\nclient.subscribe("topic-protobuf", "my-sub", consumerConf, consumer);\nMessage msg;\nconsumer.receive(msg);\nUser user2;\nuser2.ParseFromArray(msg.getData(), msg.getLength());\n')))))),(0,r.kt)("h3",{id:"protobuf"},"Protobuf"),(0,r.kt)(o.Z,{groupId:"api-choice",defaultValue:"Java",values:[{label:"Java",value:"Java"},{label:"C++",value:"C++"},{label:"Go",value:"Go"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"Java",mdxType:"TabItem"},(0,r.kt)("p",null,"Constructing a protobuf schema using Java is similar to constructing a ",(0,r.kt)("inlineCode",{parentName:"p"},"ProtobufNative")," schema. The only difference is to use ",(0,r.kt)("inlineCode",{parentName:"p"},"PROTOBUF")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"PROTOBUF_NATIVE")," when defining schema type as shown below."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate the ",(0,r.kt)("inlineCode",{parentName:"p"},"DemoMessage")," class using Protobuf3 or later versions."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\nmessage DemoMessage {\n   string stringField = 1;\n   double doubleField = 2;\n   int32 intField = 6;\n   TestEnum testEnum = 4;\n   SubMessage nestedField = 5;\n   repeated string repeatedField = 10;\n   proto.external.ExternalMessage externalMessage = 11;\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer/consumer to send/receive messages."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Producer<DemoMessage> producer = pulsarClient.newProducer(Schema.PROTOBUF(DemoMessage.class))\n       .topic("my-topic")\n       .create();\nConsumer<DemoMessage> consumer = pulsarClient.newConsumer(Schema.PROTOBUF(DemoMessage.class))\n       .topic("my-topic")\n       .subscriptionName("my-sub")\n       .subscribe();\n\nSchemaDemo schemaDemo = new SchemaDemo();\nschemaDemo.name = "puslar";\nschemaDemo.age = 20;\nproducer.newMessage().value(DemoMessage.newBuilder().setStringField("string-field-value")\n    .setIntField(1).build()).send();\n\nMessage<DemoMessage> message = consumer.receive(5, TimeUnit.SECONDS);\n'))))),(0,r.kt)(s.Z,{value:"C++",mdxType:"TabItem"},(0,r.kt)("p",null,"Constructing a protobuf schema using C++ is similar to that using ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON"),". The only difference is to use ",(0,r.kt)("inlineCode",{parentName:"p"},"PROTOBUF")," instead of ",(0,r.kt)("inlineCode",{parentName:"p"},"JSON")," when defining the schema type as shown below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'std::string jsonSchema =\n   R"({"type":"record","name":"cpx","fields":[{"name":"re","type":"double"},{"name":"im","type":"double"}]})";\nSchemaInfo schemaInfo = SchemaInfo(pulsar::PROTOBUF, "PROTOBUF", jsonSchema);\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer to send messages."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'Producer producer;\nclient.createProducer("my-topic", ProducerConfiguration().setSchema(schemaInfo), producer);\nstd::string jsonData = "{\\"re\\":2.1,\\"im\\":1.23}";\nproducer.send(MessageBuilder().setContent(std::move(jsonData)).build());\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a consumer to receive messages."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-cpp"},'Consumer consumer;\nclient.subscribe("my-topic", "my-sub", ConsumerConfiguration().setSchema(schemaInfo),   consumer);\nMessage msg;\nconsumer.receive(msg);\n'))))),(0,r.kt)(s.Z,{value:"Go",mdxType:"TabItem"},(0,r.kt)("p",null,"Suppose you have a ",(0,r.kt)("inlineCode",{parentName:"p"},"protobufDemo")," class as follows, and you'd like to transmit it in JSON form over a Pulsar topic."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'type protobufDemo struct {\n    Num                  int32    `protobuf:"varint,1,opt,name=num,proto3" json:"num,omitempty"`\n    Msf                  string   `protobuf:"bytes,2,opt,name=msf,proto3" json:"msf,omitempty"`\n    XXX_NoUnkeyedLiteral struct{} `json:"-"`\n    XXX_unrecognized     []byte   `json:"-"`\n    XXX_sizecache        int32    `json:"-"`\n}\n')),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add a ",(0,r.kt)("inlineCode",{parentName:"p"},"protoSchemaDef")," like this:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'var (\n    protoSchemaDef = "{\\"type\\":\\"record\\",\\"name\\":\\"Example\\",\\"namespace\\":\\"test\\"," +\n        "\\"fields\\":[{\\"name\\":\\"num\\",\\"type\\":\\"int\\"},{\\"name\\":\\"msf\\",\\"type\\":\\"string\\"}]}"\n)\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a producer/consumer to send/receive messages:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-go"},'psProducer := pulsar.NewProtoSchema(protoSchemaDef, nil)\nproducer, err := client.CreateProducer(pulsar.ProducerOptions{\n    Topic:  "proto",\n    Schema: psProducer,\n})\nmsgId, err := producer.Send(context.Background(), &pulsar.ProducerMessage{\n    Value: &protobufDemo{\n        Num: 100,\n        Msf: "pulsar",\n  },\n})\npsConsumer := pulsar.NewProtoSchema(protoSchemaDef, nil)\nconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\n    Topic:                       "proto",\n    SubscriptionName:            "sub-1",\n    Schema:                      psConsumer,\n    SubscriptionInitialPosition: pulsar.SubscriptionPositionEarliest,\n})\nmsg, err := consumer.Receive(context.Background())\n')))))),(0,r.kt)("h3",{id:"native-avro"},"Native Avro"),(0,r.kt)("p",null,"This example shows how to construct a ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#struct-schema"},"native Avro schema"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'org.apache.avro.Schema nativeAvroSchema = \u2026 ;\nProducer<byte[]> producer = pulsarClient.newProducer().topic("ingress").create();\nbyte[] content = \u2026 ;\nproducer.newMessage(Schema.NATIVE_AVRO(nativeAvroSchema)).value(content).send();\n')),(0,r.kt)("h3",{id:"auto_produce"},"AUTO_PRODUCE"),(0,r.kt)("p",null,"Suppose you have a Pulsar topic ",(0,r.kt)("em",{parentName:"p"},"P"),", a producer processing messages from a Kafka topic ",(0,r.kt)("em",{parentName:"p"},"K"),", an application reading the messages from ",(0,r.kt)("em",{parentName:"p"},"K")," and writing the messages to ",(0,r.kt)("em",{parentName:"p"},"P"),"."),(0,r.kt)("p",null,"This example shows how to construct an ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#auto-schema"},"AUTO_PRODUCE")," schema to verify whether the bytes produced by ",(0,r.kt)("em",{parentName:"p"},"K")," can be sent to ",(0,r.kt)("em",{parentName:"p"},"P"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Produce<byte[]> pulsarProducer = client.newProducer(Schema.AUTO_PRODUCE_BYTES())\n    \u2026\n    .create();\nbyte[] kafkaMessageBytes = \u2026 ; \npulsarProducer.produce(kafkaMessageBytes);\n")),(0,r.kt)("h3",{id:"auto_consume"},"AUTO_CONSUME"),(0,r.kt)("p",null,"Suppose you have a Pulsar topic ",(0,r.kt)("em",{parentName:"p"},"P")," and a consumer ",(0,r.kt)("em",{parentName:"p"},"MySQL")," that receives messages from ",(0,r.kt)("em",{parentName:"p"},"P"),", and you want to check if these messages have the information that your application needs to count."),(0,r.kt)("p",null,"This example shows how to construct an ",(0,r.kt)("a",{parentName:"p",href:"/docs/next/schema-understand#auto-schema"},"AUTO_CONSUME schema")," to verify whether the bytes produced by ",(0,r.kt)("em",{parentName:"p"},"P")," can be sent to ",(0,r.kt)("em",{parentName:"p"},"MySQL"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Consumer<GenericRecord> pulsarConsumer = client.newConsumer(Schema.AUTO_CONSUME())\n    \u2026\n    .subscribe();\n\nMessage<GenericRecord> msg = consumer.receive() ; \nGenericRecord record = msg.getValue();\nrecord.getFields().forEach((field -> {\n   if (field.getName().equals("theNeedFieldName")) {\n       Object recordField = record.getField(field);\n       //Do some things \n   }\n}));\n')),(0,r.kt)("h2",{id:"customize-schema-storage"},"Customize schema storage"),(0,r.kt)("p",null,"By default, Pulsar stores various data types of schemas in ",(0,r.kt)("a",{parentName:"p",href:"https://bookkeeper.apache.org"},"Apache BookKeeper")," deployed alongside Pulsar. Alternatively, you can use another storage system if needed. "),(0,r.kt)("p",null,"To use a non-default (non-BookKeeper) storage system for Pulsar schemas, you need to implement the following Java interfaces before ",(0,r.kt)("a",{parentName:"p",href:"#deploy-custom-schema-storage"},"deploying custom schema storage"),": "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#implement-schemastorage-interface"},"SchemaStorage interface")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#implement-schemastoragefactory-interface"},"SchemaStorageFactory interface"))),(0,r.kt)("h3",{id:"implement-schemastorage-interface"},"Implement ",(0,r.kt)("inlineCode",{parentName:"h3"},"SchemaStorage")," interface"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SchemaStorage")," interface has the following methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public interface SchemaStorage {\n    // How schemas are updated\n    CompletableFuture<SchemaVersion> put(String key, byte[] value, byte[] hash);\n\n    // How schemas are fetched from storage\n    CompletableFuture<StoredSchema> get(String key, SchemaVersion version);\n\n    // How schemas are deleted\n    CompletableFuture<SchemaVersion> delete(String key);\n\n    // Utility method for converting a schema version byte array to a SchemaVersion object\n    SchemaVersion versionFromBytes(byte[] version);\n\n    // Startup behavior for the schema storage client\n    void start() throws Exception;\n\n    // Shutdown behavior for the schema storage client\n    void close() throws Exception;\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"For a complete example of ",(0,r.kt)("strong",{parentName:"p"},"schema storage")," implementation, see the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java"},"BookKeeperSchemaStorage")," class.")),(0,r.kt)("h3",{id:"implement-schemastoragefactory-interface"},"Implement ",(0,r.kt)("inlineCode",{parentName:"h3"},"SchemaStorageFactory")," interface"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"SchemaStorageFactory")," interface has the following method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public interface SchemaStorageFactory {\n    @NotNull\n    SchemaStorage create(PulsarService pulsar) throws Exception;\n}\n")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"For a complete example of ",(0,r.kt)("strong",{parentName:"p"},"schema storage factory")," implementation, see the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorageFactory.java"},"BookKeeperSchemaStorageFactory")," class.")),(0,r.kt)("h3",{id:"deploy-custom-schema-storage"},"Deploy custom schema storage"),(0,r.kt)("p",null,"To use your custom schema storage implementation, perform the following steps."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Package the implementation in a ",(0,r.kt)("a",{parentName:"li",href:"https://docs.oracle.com/javase/tutorial/deployment/jar/basicsindex.html"},"JAR")," file."),(0,r.kt)("li",{parentName:"ol"},"Add the JAR file to the ",(0,r.kt)("inlineCode",{parentName:"li"},"lib")," folder in your Pulsar binary or source distribution."),(0,r.kt)("li",{parentName:"ol"},"Change the ",(0,r.kt)("inlineCode",{parentName:"li"},"schemaRegistryStorageClassName")," configuration in the ",(0,r.kt)("inlineCode",{parentName:"li"},"conf/broker.conf")," file to your custom factory class.\n"),(0,r.kt)("li",{parentName:"ol"},"Start Pulsar.")))}h.isMDXComponent=!0}}]);